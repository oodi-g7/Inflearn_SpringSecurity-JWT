# 12강. JWT를 이해하기전 세션에 대해 알아보자
## 12-1. 최초 요청시 만들어지는 세션 ID

<img src="./img/chapter12_1.png">

1. 웹 브라우저가 서버에게 <U>**최초 요청**</U>을 수행한다. (www.naver.com)
2. 요청을 받은 서버는 해당 주소에 맞는 컨트롤러의 메서드를 찾아서 www.naver.com에 해당하는 .html파일을 리턴한다.
3. 이때 서버는 응답으로 보내는 .html파일에다가 Http Header를 함께 달아서 전송한다.
    - 3-1. Http Header에는 Cookie라는 게 담겨있는데, Cookie에는 (Java일 경우)세션ID가 포함되어 있다. 
4. 웹 브라우저는 Http Header에서 받아온 세션ID정보를 웹 브라우저의 Cookie영역에다 자동저장해둔다.

## 12-2. 세션 ID의 역할

<img src="./img/chapter12_2.png">

1. 최초요청으로 인해 세션ID값을 갖게 된 웹 브라우저가 다시 한 번 서버에게 요청을 수행한다. (www.naver.com)   
<U>**이때 요청과 함께 세션ID값을 담은 Header를 같이 전송한다.**</U>

2. 요청을 받은 서버는 요청과 함께 전달받은 세션ID가 <U>**생성한 세션ID목록**</U>에 있는 세션ID인지 확인한다.
    - 2-1. 세션ID를 위조하여 요청이 오는 것을 방지하기 위해, 서버는 자신이 생성한 세션ID에 대한 목록을 만들어 이를 관리한다.
    - 2-2. 요청과 함께 세션ID를 전달받았을 경우, 서버는 생성한 세션ID 목록에서 자신이 만든 세션ID가 맞는지 비교를 통해 해당 요청이 최초인지 아닌지를 구분한다.

3. 자신이 생성한 세션ID가 맞는지 확인 후, 요청에 맞는 .html파일과 확인이 완료된 세션ID를 다시 응답 Header에 담아 웹 브라우저로 반환한다.

#### ※ 세션ID가 없으면 서버측은 해당 웹 브라우저가 최초 요청인지 아닌지를 구분하지 못함
- 서버는 최초 요청시에는 세션ID를 발급해준다.
- 그 외 요청시에는 Header에 가져온 세션ID를 생성한 세션ID목록에서 확인한 후 그대로 다시 반환해준다.

## 12-3. 세션 ID의 소멸
1. 서버에서 세션ID값을 강제로 삭제하는 경우
    - 1-1. 서버에서 관리하고 있던 생성한 세션ID 목록 내용을 강제 초기화 시키는 경우, 세션 ID가 소멸된다.
2. 사용자가 웹 브라우저를 전부 다 종료시키는 경우
    - 2-1. 웹 브라우저를 모두 닫을 경우, 웹 브라우저가 갖고 있던 쿠키 내용이 지워지므로 세션 ID가 소멸된다.
    - 2-2. 이 경우, 서버에서 관리중인 세션ID 목록에는 해당 세션 내용이 남아있다. 
    - 2-3. 하지만 웹 브라우저가 요청시에 Header에 세션ID를  담아가지 않으므로 서버는 이를 최초 요청으로 인식하고 새로운 세션 ID를 발급해 줄 것이다.
3. 특정 시간이 지났을 경우
    - 3-1. 특정 시간은 보통 30분
    - 3-2. 특정 시간이 지나면 서버에선 세션ID 정보를 삭제한다.

## 12-4. 세션방식의 활용 : 로그인

<img src="./img/chapter12_3.png">

1. 웹 브라우저가 서버에게 최초 요청을 수행한다. (www.naver.com)
2. 서버는 해당 주소에 맞는 메서드를 실행시키고, 세션ID목록에 새로운 세션ID를 생성한다.
3. 서버는 요청에 맞는 응답과 함께 응답 Header에 (2)에서 생성한 세션ID를 함께 보낸다.
4. 응답을 받은 웹 브라우저는 응답헤더에 있던 세션ID정보를 Cookie영역에다 저장해둔다.

<img src="./img/chapter12_4.png">

5. 서버로부터 세션ID를 발급받은 웹 브라우저가 발급받은 세션ID와 함께 로그인 요청을 보낸다.
6. 요청을 받은 서버는 같이 온 세션ID정보를, 갖고있는 세션ID목록과 비교한다.
7. 사용자가 입력한 로그인 정보가 맞는지 DB를 통해 조회한다.
8. DB로부터 올바른 로그인 정보임을 확인받는다.
9. 서버는 세션ID목록에서 해당 요청의 세션ID정보 내 저장소에다 방금 DB에서 조회한 유저정보를 담아둔다.
10. 로그인 정보가 정상으로 확인된 후, 서버는 로그인 완료 페이지와 함께, 요청시 받았던 세션ID정보도 웹 브라우저에게 그대로 반환한다.

<img src="./img/chapter12_5.png">

11. 로그인 완료 후, 사용자는 인증이 필요한 페이지(예를 들어 유저정보)에 대한 요청을 수행한다.
12. 서버는 해당 요청이 갖고 온 세션ID를 이용하여 세션 목록에서 해당 정보를 찾고, 해당 세션이 가지고 있는 저장소에 유저정보가 있음을 확인한다. → 로그인한 유저인지 확인
13. 로그인 한 사용자임을 확인한 후, 사용자가 요청한 유저정보를 DB에서 조회한다.
14. 조회한 유저정보를 가져온다.
15. 요청한 유저정보와 .html페이지를 응답함과 동시에, 응답헤더에 세션ID를 다시 담아 그대로 반환한다.
16. 이러한 로직이 계속해서 반복된다.

### 정리
1. 세션을 통해서 사용자 인증이 가능하다.
2. 민감정보 요청시 세션값이 있는지를 확인하여 인증된 사용자에게만 민감정보 전달이 가능하다.

## 12-5. 세션방식의 문제 및 해결
